<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HistÃ³ricas Decoloniais</title>
<style>
/ --- seu estilo original com adiÃ§Ãµes para contraste e foco --- /
:root{ --base-font:100%; }
html { font-size: var(--base-font); }

/ CORREÃ‡ÃƒO AQUI: O estilo do cabeÃ§alho que cria o efeito /
.main-title {
  font-size: 28px;
  font-weight: bold;
  background: linear-gradient(90deg, #c59f9f, #f3b735, #17c0e6, #0edba5);
  color: #4b2e2e; / marrom escuro /
  white-space: nowrap;
  overflow: hidden;
  border-right: 3px solid #a0522d; / cursor marrom /
  width: 0;
  animation: typing 4s steps(50, end) forwards,
             blink 0.8s step-end infinite;
}
@keyframes typing { from { width: 0; } to { width: 100%; } }
@keyframes blink { 50% { border-color: transparent; } }

.subtitle { text-align: center; font-size: 1.2rem; color: #4b2e2e; max-width: 800px; margin: 0 auto 1rem auto; line-height: 1.5; }
:root { --bg:#fbf6f6; --card:#d8d0d0; --fg:#0b1220; --muted:#556; --accent:#a0522d; }
body{ font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 1rem; background: #dabbac; color: var(--fg); }
h1,h2{ text-align:center; }
.card{ background:var(--card); border-radius:12px; padding:1rem; margin:1rem auto; max-width:900px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }

/ Alinhamento dos nomes das seleÃ§Ãµes (labels) Ã  esquerda /
.selection-grid { 
    display: grid;
    grid-template-columns: auto 1fr; 
    gap: 8px 15px; 
    align-items: center;
    margin-bottom: 1rem;
}
.selection-grid label {
    text-align: left; 
    font-weight: bold;
}
.selection-grid select {
    width: 100%; 
}

select,button{ padding:0.5rem; margin:0.25rem 0; border-radius:6px; border:1px solid #6e6b6b; font-size:1rem; }
button { background-color: #a0522d; color: #fff; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; }
button:hover { background-color: #8b4513; }
button:disabled{ background:#ccc; color:#666; cursor:not-allowed; }
img{ max-width:100%; border-radius:8px; margin:0.5rem 0; }
.audio-btn{ margin-right:0.5rem; }
.compare-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1rem; margin-top:1rem; }
.recording-status { margin: 10px 0; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; }
.recording-active { background-color: #ffebee; color: #c62828; border: 1px solid #c62828; }
.recording-saved { background-color: #e8f5e8; color: #2e7d32; border: 1px solid #2e7d32; }

/ alto contraste /
.high-contrast { background:#000 !important; color:#fff !important; }
.high-contrast .card { background:#111 !important; color:#fff !important; border: 1px solid #fff; }
.high-contrast button { background:#fff !important; color:#000 !important; border:1px solid #000 !important; }

/ controles extras /
.controls-row { margin-top: 8px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; 
Â  justify-content: space-between; 
}
.small-btn { padding:6px 10px; font-size:0.9rem; border-radius:6px; background:#fff; color:#333; border:1px solid #999; cursor:pointer; }
.small-btn:focus { outline:3px solid #ffd600; }

/ foco visÃ­vel /
button:focus, select:focus { outline:3px solid #ffd600; outline-offset:2px; }

/ JUSTIFICAÃ‡ÃƒO DO TEXTO DA NARRATIVA /
#narrativeText {
    text-align: justify;
    line-height: 1.6;
}

/ RodapÃ© /
.footer {
    text-align: center;
    margin-top: 30px;
    padding: 10px 0;
    font-size: 0.9rem;
    color: #4b2e2e;
}
.high-contrast .footer {
    color: #aaa;
}
</style>
</head>
<body>
<h1 class="main-title">HistÃ³rias em Vozes: Um Olhar Decolonial</h1>
<p class="subtitle">Agora vamos comparar as narrativas histÃ³ricas. Podemos dizer que a histÃ³ria dos livros sempre tem razÃ£o em relaÃ§Ã£o aos eventos histÃ³ricos?</p>

<div class="card" aria-label="SeleÃ§Ã£o e narrativa">
Â  <fieldset>
Â  Â  <legend>Selecione evento e narrador</legend>
    <div class="selection-grid">
Â  Â  Â  <label for="eventoSelect">Evento:</label>
Â  Â  Â  <select id="eventoSelect" aria-label="Selecionar evento"></select>
Â  Â  Â  <label for="narradorSelect">Narrador:</label>
Â  Â  Â  <select id="narradorSelect" aria-label="Selecionar narrador"></select>
Â  Â  Â  <label for="voiceSelect">Voz para a narrativa:</label>
Â  Â  Â  <select id="voiceSelect" aria-label="Selecionar voz para a narrativa"></select>
    </div>

Â  Â  <div class="controls-row" role="toolbar" aria-label="Controles principais">
        <div style="display:flex; gap:8px;">
            <button id="showNarrative">Mostrar narrativa</button>
            <button id="resetView">Limpar</button>
            <button id="compareBtn">Comparar narrativas</button>
        </div>

Â  Â  Â  <div style="display:flex; gap:8px;">
Â  Â  Â  Â  Â  <button id="contrastToggle" class="small-btn" aria-pressed="false" title="Alternar alto contraste">Alto contraste</button>
Â  Â  Â  Â  Â  <button id="fontInc" class="small-btn" title="Aumentar fonte">A+</button>
Â  Â  Â  Â  Â  <button id="fontDec" class="small-btn" title="Diminuir fonte">Aâˆ’</button>
        </div>
Â  Â  </div>
Â  </fieldset>

Â  <div id="narrativeArea">
Â  Â  <h2>Narrativa</h2>
Â  Â  <div id="narrativeText" tabindex="0">Selecione um evento e um narrador, depois clique em "Mostrar narrativa".</div>
Â  Â  <div id="eventImageContainer" aria-live="polite"></div>

Â  Â  <div id="audioControls" class="controls-row" aria-label="Controles de Ã¡udio">
Â  Â  Â  <button id="playAudio" class="audio-btn">â–¶ï¸ Reproduzir Ãudio</button>
Â  Â  Â  <button id="stopAudio" class="audio-btn">â¹ï¸ Parar Ãudio</button>
Â  Â  Â  <button id="playAD" class="audio-btn" disabled>â™¿ AudiodescriÃ§Ã£o</button>
Â  Â  </div>
Â  Â  <div id="comparisonArea"></div>
</div>

<div class="card">
Â  <h2>Conte-nos seu ponto de vista da histÃ³ria</h2>
Â  <p>Selecione um Evento. <strong>Ao parar a gravaÃ§Ã£o, o Ã¡udio serÃ¡ salvo automaticamente</strong> para o narrador <strong>"Estudante"</strong> neste evento.</p>
Â  <div id="recordingStatus" class="recording-status"></div>
Â  <button id="recStart">ğŸ”´ Iniciar GravaÃ§Ã£o</button>
Â  <button id="recStop" disabled>â¹ï¸ Parar e Salvar</button>
Â  <button id="recPlay" disabled>â–¶ï¸ Reproduzir GravaÃ§Ã£o</button>
Â  <button id="recDelete" disabled>ğŸ—‘ï¸ Excluir GravaÃ§Ã£o</button>
</div>

<footer class="footer">
  Â© 2025 Aline ConceiÃ§Ã£o Brito â€” Desenvolvido para fins pedagÃ³gicos. Todos os direitos reservados.
</footer>

<script>
/ ===================== DADOS (MANTIDOS) ===================== /
const audioMapping = {
Â  "ColonizaÃ§Ã£o do Brasil (sÃ©culo XVI e XVII)": {
Â  Â  "Cronista portuguÃªs": "https://soundcloud.com/aline-brito-225256690/portugues-chegada-2/s-dCPg2UDkmtL?in=aline-brito-225256690/sets/escolar/s-LJ6nxpK4cQY&si=229f25582b844b16bf9280a544b66294&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing",
Â  Â  "IndÃ­gena": "https://github.com/allineBrito/faculdade/blob/main/audio/portugues1.mp3",
Â  Â  "Africano escravizado": "audio/negros-chegada.wav",
Â  },
Â  "PerÃ­odo das Revoltas Regenciais (1831 â€“ 1840)": {
Â  Â  "Cronista portuguÃªs": "https://github.com/allineBrito/estudos_projetos/blob/main/audio/portuges-chegada.mp3",
Â  Â  "IndÃ­gena": "audio/revolta_indi.mp3",
Â  Â  "Africano escravizado": "audio/revolta_afri.mp3",
Â  },
Â  "Guerra de Canudos (1893 â€“ 1897)": {
Â  Â  "Cronista portuguÃªs": "audio/revolta_port.mp3",
Â  Â  "IndÃ­gena": "audio/revolta_indi.mp3",
Â  Â  "Africano escravizado": "audio/revolta_afri.mp3",
Â  }
};

const imageMapping = {
Â  "Cronista portuguÃªs": "https://exemplo.com/perfil_cronista.jpg",
Â  "IndÃ­gena": "https://exemplo.com/perfil_indigena.png",
Â  "Africano escravizado": "https://exemplo.com/perfil_africano.png",
Â  "Mulher negra": "https://exemplo.com/perfil_mulher_negra.jpg",
Â  "Estudante": "https://e7.pngegg.com/pngimages/576/837/png-clipart-student-school-student-child-people.png"
};

const eventImageMapping = {
Â  "ColonizaÃ§Ã£o do Brasil (sÃ©culo XVI e XVII)": {
Â  Â  "Cronista portuguÃªs": "https://i.postimg.cc/Px50VhZn/Chat-GPT-Image-15-de-out-de-2025-12-17-49.png",
Â  Â  "IndÃ­gena": "https://i.postimg.cc/xCphW7yG/Chat-GPT-Image-15-de-out-de-2025-12-22-26.png",
Â  Â  "Africano escravizado": "https://i.postimg.cc/V6Zp3TBj/Chat-GPT-Image-15-de-out-de-2025-12-25-26.png",
    "Estudante": "https://e7.pngegg.com/pngimages/576/837/png-clipart-student-school-student-child-people.png"
Â  },
  
Â  "PerÃ­odo das Revoltas Regenciais (1831 â€“ 1840)": {
Â  Â  "Cronista portuguÃªs": "https://i.postimg.cc/rwL41pXf/Chat-GPT-Image-15-de-out-de-2025-12-36-56.png",
    "IndÃ­gena": "https://i.postimg.cc/c12wJmFF/Chat-GPT-Image-15-de-out-de-2025-12-41-13.png",
    "Africano escravizado": "https://i.postimg.cc/YCwF6SK8/Chat-GPT-Image-15-de-out-de-2025-12-44-04.png",
    "Estudante": "https://e7.pngegg.com/pngimages/576/837/png-clipart-student-school-student-child-people.png"
Â  },
  
Â  "Guerra de Canudos (1893 â€“ 1897)": {
Â  Â  "Cronista portuguÃªs": "https://biografiaresumida.com.br/wp-content/webp-express/webp-images/uploads/2019/01/Guerra-de-Canudos.jpg.webp",
Â  Â  "IndÃ­gena": "https://bahia.ws/wp-content/uploads/2012/11/guerra_dos_canudos.jpg",
Â  Â  "Africano escravizado": "https://static.wixstatic.com/media/02a26c_fac557e40b9840ad80c9419333af4344~mv2.jpg/v1/fill/w_568,h_320,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/02a26c_fac557e40b9840ad80c9419333af4344~mv2.jpg",
Â    "Estudante": "https://e7.pngegg.com/pngimages/576/837/png-clipart-student-school-student-child-people.png"
  }
};

const data = {
  "ColonizaÃ§Ã£o do Brasil (sÃ©culo XVI e XVII)": {
    narrativas: {
      "Cronista portuguÃªs": "Escutem, fiÃ©is sÃºditos do Reino de Portugal! O que vemos no Brasil nÃ£o Ã© sÃ³ uma terra distante, mas um novo e grandioso pilar do nosso ImpÃ©rio. Desde a chegada de Cabral, cumprimos o dever de tomar posse e levar a luz da nossa civilizaÃ§Ã£o a estas terras do Novo Mundo. Nosso objetivo Ã© claro: a riqueza. Fizemos do litoral nordestino o maior produtor de aÃ§Ãºcar do mundo â€” o nosso Ouro Branco â€” que enriquece a Europa e fortalece os cofres da Coroa. O sistema colonial que criamos Ã© firme e organizado: a monocultura, o Pacto Colonial e a ordem que garante que toda a abundÃ¢ncia â€” do aÃ§Ãºcar, da madeira, dos animais e do tabaco â€” beneficie Lisboa. Aqui nada se perde. Tudo serve para a glÃ³ria do Reino de Portugal.",
      "IndÃ­gena": "Quando o povo do mar chegou, nossa vida mudou para sempre. Eles vieram como invasores, nÃ£o como amigos. No comeÃ§o, sentimos curiosidade e trocamos pau-brasil por ferro. Mas logo entendemos a verdade: queriam nossas terras e nossos corpos. Para eles, a floresta era mercadoria. Para nÃ³s, era mÃ£e, caÃ§a e memÃ³ria dos ancestrais. Tentaram nos escravizar em plantaÃ§Ãµes erguidas sobre nossas aldeias. Chamaram-nos de Ã­ndios cativos e venderam-nos como animais. As doenÃ§as que trouxeram â€” como varÃ­ola e sarampo â€” mataram muitas aldeias, mais do que as armas. Ainda assim, resistimos. Lutamos por nossos chefes, por nosso povo e por nossa liberdade. Nossa cultura e nossa lÃ­ngua continuam vivas. A histÃ³ria do Brasil Ã© tambÃ©m a histÃ³ria da nossa resistÃªncia, que nunca acabou.",
      "Africano escravizado": "Nossa histÃ³ria nÃ£o comeÃ§ou no Brasil, mas nas terras da Ãfrica. Fomos tirados de nossos reinos Ã  forÃ§a. O que os portugueses chamam de comÃ©rcio, nÃ³s chamamos de Grande Roubo. Fomos levados em navios apertados, onde a fome e as doenÃ§as matavam muitos antes de chegar aqui. No Brasil, nÃ£o Ã©ramos vistos como pessoas, mas como peÃ§as. Nosso corpo pertencia ao senhor, e nosso tempo era marcado pelo sol e pelo chicote. Nas plantaÃ§Ãµes e engenhos, o trabalho era pesado e a violÃªncia, constante. Nossa vida valia menos que o aÃ§Ãºcar que produzÃ­amos. Mas nunca aceitamos o cativeiro. ConstruÃ­mos quilombos, guardamos nossas culturas e nossa fÃ©. O Brasil colonial foi feito de dor e escravidÃ£o, mas tambÃ©m de luta e coragem. Nossa resistÃªncia nunca foi vencida.",
      "Estudante": ""
    },
    ad: {
      "Cronista portuguÃªs": "Em uma pintura de estilo antigo, um homem europeu de barba escura, vestido com roupas tÃ­picas do sÃ©culo XVI, fala com expressÃ£o solene diante de outros colonos. AtrÃ¡s dele, um grande pergaminho exibe um texto em portuguÃªs exaltando o ImpÃ©rio. Ao fundo, vÃª-se uma paisagem tropical, com palmeiras, rio e um navio portuguÃªs ancorado. A cena transmite poder e domÃ­nio colonial",
      "IndÃ­gena": "Em uma pintura de tons quentes, um homem indÃ­gena aparece em primeiro plano, com expressÃ£o de indignaÃ§Ã£o e resistÃªncia. Ele estÃ¡ de pÃ©, com o corpo pintado e adornado por colar e pena na cabeÃ§a. Ao fundo, hÃ¡ uma aldeia, floresta densa e um navio europeu no rio. PrÃ³ximo dele, um colonizador observa com semblante sÃ©rio. A imagem expressa o choque e o conflito entre os povos originÃ¡rios e os colonizadores",
      "Africano escravizado": "Em uma pintura de tom sÃ©pia e realista, um homem negro aparece em primeiro plano, com expressÃ£o firme e olhar voltado para frente. Ele estÃ¡ sem camisa, usa uma calÃ§a simples e carrega pesadas correntes de ferro presas ao pescoÃ§o e aos pulsos. Ao lado, um homem branco com chapÃ©u e barba observa em silÃªncio. Ao fundo, trabalhadores aparecem cortando cana em uma plantaÃ§Ã£o e, mais distante, um navio estÃ¡ ancorado junto Ã  costa. A cena transmite sofrimento, resistÃªncia e dignidade diante da opressÃ£o",
      "Estudante": "AudiodescriÃ§Ã£o do estudante."
    }
  },

  "PerÃ­odo das Revoltas Regenciais (1831 â€“ 1840)": {
    narrativas: {
      "Cronista portuguÃªs": "A ordem do ImpÃ©rio estÃ¡ ameaÃ§ada e a unidade do paÃ­s corre perigo. A falta de um imperador adulto abriu espaÃ§o para facÃ§Ãµes rebeldes e para a pior parte da sociedade. Somos os guardiÃµes da civilizaÃ§Ã£o que Portugal trouxe a estas terras. Nosso dever Ã© manter o Brasil unido, prÃ³spero e hierÃ¡rquico. As revoltas no ParÃ¡, na Bahia e no MaranhÃ£o nÃ£o sÃ£o por justiÃ§a, mas por desordem. SÃ£o grupos de desocupados, Ã­ndios, caboclos e africanos que, em sua ignorÃ¢ncia, atacam a base da nossa economia. Nossas tropas agirÃ£o com forÃ§a para esmagar essas sediÃ§Ãµes, restaurar a paz e mostrar ao mundo que o Brasil sabe se governar. Quem ameaÃ§ar a ordem serÃ¡ tratado como traidor da pÃ¡tria.",
      "IndÃ­gena": "Nos chamam de cabanos, selvagens e desordeiros, mas somos os verdadeiros donos da floresta e das Ã¡guas. Nossos antepassados cuidaram desta terra. Vimos os barÃµes do aÃ§Ãºcar e do gado roubarem nossa terra enquanto vivem nas cidades. Quando D. Pedro I partiu, achamos que serÃ­amos ouvidos â€” nada mudou para quem vive na pobreza Ã  beira do rio. A escravidÃ£o, a humilhaÃ§Ã£o e o roubo do nosso sustento continuam. Pegamos em armas por fome e por justiÃ§a. Queremos governar o ParÃ¡, que a terra pertenÃ§a a quem a trabalha, e que os tiranos que exploram nosso suor sejam expulsos. Lutamos para sobreviver; a forÃ§a da floresta estÃ¡ conosco e nosso pedido por um governo justo Ã© mais forte que as balas do ImpÃ©rio.",
      "Africano escravizado": "Nos trouxeram em escravidÃ£o, mas nÃ£o conseguiram tomar nossa fÃ© nem nosso saber. Vimos a fraqueza do governo e soubemos que era hora de agir. Na Bahia, nos engenhos e nas ruas de Salvador, nÃ³s, os MalÃªs, estÃ¡vamos prontos. ConhecÃ­amos disciplina e a Lei de AlÃ¡. QuerÃ­amos libertar nossos irmÃ£os, acabar com os senhores que nos oprimiam e criar um lugar de justiÃ§a guiado por nossa crenÃ§a. LutÃ¡vamos pela liberdade do corpo e da alma. Fomos traÃ­dos e a repressÃ£o foi terrÃ­vel: nos prenderam, chicotearam e executaram. Mesmo assim, provamos que o escravo sabe resistir. Mostramos que podemos nos organizar e gerar esperanÃ§a para quem sonha quebrar as correntes.",
      "Estudante": ""
    },
    ad: {
      "Cronista portuguÃªs": "Em tons sÃ©pia e claros, a imagem retrata um cronista portuguÃªs do sÃ©culo XIX, com expressÃ£o sÃ©ria e postura imponente. Ele veste roupas formais da Ã©poca imperial â€” casaca longa, colete e gravata. AtrÃ¡s dele, aparece um cenÃ¡rio que remete Ã  colÃ´nia: uma grande sala com mapa do Brasil ao fundo e bandeiras imperiais. No canto direito, tropas marcham ao longe, simbolizando a repressÃ£o Ã s revoltas regenciais. O cronista segura uma pena e um pergaminho, como se estivesse registrando os eventos. A luz incide sobre seu rosto e seus escritos, realÃ§ando a ideia de autoridade e controle narrativo. A cena sugere poder, hierarquia e o olhar eurocÃªntrico sobre as rebeliÃµes populares no Brasil",
      "IndÃ­gena": "A imagem mostra um homem indÃ­gena de aparÃªncia sÃ©ria e olhar firme, retratado do tronco para cima. Sua pele Ã© de tom cobre, e seus traÃ§os sÃ£o fortes â€” rosto largo, expressÃ£o determinada e olhos voltados para frente. Ele tem cabelos longos e lisos, que caem atÃ© os ombros. Na cabeÃ§a, usa um cocar simples, feito com penas marrons presas por uma faixa tranÃ§ada. O homem estÃ¡ sem camisa, usando apenas um colar de corda fina e uma saia curta de tecido simples. Na mÃ£o direita, segura uma lanÃ§a de madeira. Ao fundo, a paisagem Ã© suave e em tons esverdeados, mostrando a floresta borrada, sugerindo a imensidÃ£o da natureza. A imagem tem tons terrosos e claros, como se fosse uma pintura feita em papel envelhecido, transmitindo uma sensaÃ§Ã£o de ancestralidade, resistÃªncia e ligaÃ§Ã£o com a terra.",
      "Africano escravizado": "A imagem mostra um homem negro de expressÃ£o firme e olhar determinado, retratado do tronco para cima. Ele tem a pele escura, o rosto alongado e o olhar voltado ligeiramente para o lado, com semblante de coragem e resistÃªncia. Usa uma tÃºnica simples, de tecido claro e leve, presa na cintura por uma faixa amarrada. Na cabeÃ§a, hÃ¡ um pano branco enrolado como um turbante, e ele segura um bastÃ£o de madeira com a mÃ£o direita. O fundo Ã© composto por tons terrosos e suaves, lembrando um campo aberto ou uma paisagem rural com Ã¡rvores difusas ao longe. A ilustraÃ§Ã£o Ã© feita em estilo sÃ©pia, com aparÃªncia de desenho a lÃ¡pis sobre papel envelhecido, transmitindo uma atmosfera histÃ³rica e emocional. A imagem evoca a forÃ§a, a dignidade e o espÃ­rito de luta de um africano escravizado que resiste Ã  opressÃ£o.",
      "Estudante": "AudiodescriÃ§Ã£o do estudante."
    }
  },

  "Guerra de Canudos (1893 â€“ 1897)": {
    narrativas: {
      "Cronista portuguÃªs": "O movimento de Canudos foi visto como uma grande ameaÃ§a Ã  RepÃºblica. Liderados por um homem considerado fanÃ¡tico, as tropas do exÃ©rcito agiram para acabar com esse foco de desordem e impedir que ele atrapalhasse o progresso do paÃ­s.",
      "IndÃ­gena": "NÃ³s, os antigos donos desta terra, jÃ¡ sofremos demais nas mÃ£os dos homens de fora. A seca nos castiga, mas a ganÃ¢ncia dos coronÃ©is Ã© pior. Em Canudos, AntÃ´nio Conselheiro nÃ£o falava apenas de Deus, ele falava de justiÃ§a e de um lugar onde nÃ£o serÃ­amos mais obrigados a beijar a mÃ£o de quem nos explora. A RepÃºblica que chegou nÃ£o mudou nada para o sertanejo pobre, pelo contrÃ¡rio: ela trouxe a exigÃªncia de impostos e a obrigaÃ§Ã£o de servir aos poderosos. O ataque a Canudos nÃ£o foi contra a 'desordem', foi para sufocar a Ãºnica chance de vivermos livres e com dignidade em nosso prÃ³prio chÃ£o, longe da humilhaÃ§Ã£o e da fome imposta por aqueles que sÃ³ pensam em acumular terras.",
      "Africano escravizado": "Cinco anos depois da liberdade, para muitos de nÃ³s, a escravidÃ£o sÃ³ mudou de nome. A terra prometida nÃ£o chegou, e a misÃ©ria nos empurra para os mesmos latifÃºndios. Canudos foi um farol no sertÃ£o. O Conselheiro falava de um reino de Deus na Terra, onde os Ãºltimos seriam os primeiros, e isso ecoava a esperanÃ§a que nunca morre no peito de quem carrega a memÃ³ria do cativeiro. LÃ¡, Ã©ramos todos iguais na fÃ© e na luta, sem a marca da cor ou da senzala. A matanÃ§a do ExÃ©rcito nÃ£o foi um 'progresso', foi a repetiÃ§Ã£o da violÃªncia que sempre tentou calar nossa voz. Eles destruÃ­ram o arraial, mas a crenÃ§a na terra sem males, na resistÃªncia contra o opressor, Ã© uma semente que o fogo e a bala jamais poderÃ£o apagar. Canudos Ã© o nosso quilombo do sertÃ£o.",
      "Estudante": ""
    },
    ad: {
      "Cronista portuguÃªs": "Foto do exÃ©rcito em Canudos.",
      "IndÃ­gena": "Foto de sertanejos em Canudos.",
      "Africano escravizado": "Gravura de AntÃ´nio Conselheiro.",
      "Estudante": "AudiodescriÃ§Ã£o do estudante."
    }
  }
};

// Mapeamento de vozes
const voiceMapping = {
Â  "Cronista portuguÃªs": "Google portuguÃªs do Brasil",
Â  "IndÃ­gena": "Microsoft Maria - Portuguese (Brazil)",
Â  "Africano escravizado": "Microsoft Daniel - Portuguese (Brazil)"
};


/ ===================== elementos DOM ===================== /
const eventoSelect=document.getElementById('eventoSelect');
const narradorSelect=document.getElementById('narradorSelect');
const voiceSelect=document.getElementById('voiceSelect'); 
const narrativeText=document.getElementById('narrativeText');
const eventImageContainer=document.getElementById('eventImageContainer');
const playAudioBtn=document.getElementById('playAudio');
const stopAudioBtn=document.getElementById('stopAudio');
const playADBtn=document.getElementById('playAD');
const compareBtn=document.getElementById('compareBtn');
const comparisonArea=document.getElementById('comparisonArea');
const resetViewBtn=document.getElementById('resetView');

const contrastToggle = document.getElementById('contrastToggle');
const fontInc = document.getElementById('fontInc');
const fontDec = document.getElementById('fontDec');

const recStartBtn = document.getElementById('recStart');
const recStopBtn = document.getElementById('recStop');
const recPlayBtn = document.getElementById('recPlay');
const recDeleteBtn = document.getElementById('recDelete');
const recordingStatus = document.getElementById('recordingStatus');

/ ===================== preencher selects ===================== /
Object.keys(data).forEach(ev=>{
Â  let opt=document.createElement('option'); opt.value=ev; opt.textContent=ev;
Â  eventoSelect.appendChild(opt);
});
function populateNarrators(){
Â  narradorSelect.innerHTML='';
Â  if(eventoSelect.value && data[eventoSelect.value]){
Â  Â  Object.keys(data[eventoSelect.value].narrativas).forEach(n=>{
Â  Â  Â  let o=document.createElement('option'); o.value=n; o.textContent=n;
Â  Â  Â  narradorSelect.appendChild(o);
Â  Â  });
Â  Â  updateVoiceSelection(); 
Â  }
}
eventoSelect.addEventListener('change', populateNarrators);
narradorSelect.addEventListener('change', updateVoiceSelection); 
populateNarrators();

/ ===================== CONTRASTE e FONTE ===================== /
contrastToggle.addEventListener('click', ()=> {
Â  const pressed = contrastToggle.getAttribute('aria-pressed') === 'true';
Â  contrastToggle.setAttribute('aria-pressed', String(!pressed));
Â  document.body.classList.toggle('high-contrast');
Â  contrastToggle.focus();
});
let baseFont = 100; // percent
fontInc.addEventListener('click', ()=> { baseFont = Math.min(160, baseFont + 10); document.documentElement.style.setProperty('--base-font', baseFont + '%'); fontInc.focus(); });
fontDec.addEventListener('click', ()=> { baseFont = Math.max(70, baseFont - 10); document.documentElement.style.setProperty('--base-font', baseFont + '%'); fontDec.focus(); });

/ ===================== Mostrar narrativa ===================== /
resetViewBtn.addEventListener('click', ()=>{
Â  eventoSelect.selectedIndex=0; narradorSelect.innerHTML=''; narrativeText.textContent='Selecione um evento e um narrador, depois clique em "Mostrar narrativa".';
Â  eventImageContainer.innerHTML=''; playADBtn.disabled=true; comparisonArea.innerHTML=''; updateRecordingStatus('');
Â  populateNarrators(); 
});
document.getElementById('showNarrative').addEventListener('click', ()=>{
Â  const ev=eventoSelect.value, nar=narradorSelect.value;
Â  if(!ev || !nar) return;
Â  if (nar === "Estudante" && hasRecordingForCurrentEvent()) {
Â  Â  narrativeText.textContent = "ğŸ¤ Narrativa em Ã¡udio disponÃ­vel - clique em 'Reproduzir GravaÃ§Ã£o' para ouvir.";
Â  } else {
Â  Â  narrativeText.textContent = data[ev].narrativas[nar] || '';
Â  }
Â  const eventImgSrc = eventImageMapping[ev] ? eventImageMapping[ev][nar] : '';
Â  let imageToShow = eventImgSrc || imageMapping[nar] || '';
Â  let altText = imageToShow ? `Imagem do evento ${ev} na perspectiva de ${nar}` : '';
Â  eventImageContainer.innerHTML = imageToShow ? `<img src="${imageToShow}" alt="${altText}">` : '';
Â  playADBtn.disabled = !data[ev].ad[nar];
Â  playADBtn.onclick = ()=> speakText(data[ev].ad[nar] || '', "pt-BR", nar);
});

/ ===================== comparar ===================== /
compareBtn.addEventListener('click', ()=>{
Â  const ev=eventoSelect.value; if(!ev) return;
Â  const narrativas=data[ev].narrativas; const ads=data[ev].ad;
Â  comparisonArea.innerHTML = "<h2>ComparaÃ§Ã£o de Narrativas</h2>";
Â  const container=document.createElement('div'); container.className="compare-grid";
Â  Object.keys(narrativas).forEach(n=>{
Â  Â  const div=document.createElement('div'); div.className='card';
Â  Â  const compareImgSrc = eventImageMapping[ev] && eventImageMapping[ev][n] ? eventImageMapping[ev][n] : imageMapping[n];
Â  Â  const altText = `Imagem do evento ${ev} na perspectiva de ${n}`;
Â  Â  let textoNarrativa = narrativas[n] || '';
Â  Â  if (n === "Estudante" && hasRecordingForCurrentEvent()) textoNarrativa = "ğŸ¤ Narrativa em Ã¡udio (gravaÃ§Ã£o do estudante)";
Â  Â  div.innerHTML = `
Â  Â  Â  <h3>${n}</h3>
Â  Â  Â  <p style="text-align: justify; line-height: 1.6;">${textoNarrativa}</p>
Â  Â  Â  ${compareImgSrc ? `<img src="${compareImgSrc}" alt="${altText}">` : ''}
Â  Â  Â  <div style="margin-top:8px;">
Â  Â  Â  Â  <button class="small-btn" data-narr="${encodeURIComponent(n)}">â–¶ï¸ Ãudio</button>
Â  Â  Â  Â  <button class="small-btn" data-ad="${encodeURIComponent(ads[n]||'')}">â™¿ AudiodescriÃ§Ã£o</button>
Â  Â  Â  </div>
Â  Â  `;
Â  Â  container.appendChild(div);
Â  });
Â  comparisonArea.appendChild(container);
Â  // listeners:
Â  comparisonArea.querySelectorAll('button.small-btn').forEach(btn=>{
Â  Â  btn.addEventListener('click', ()=>{
Â  Â  Â  const narr = decodeURIComponent(btn.getAttribute('data-narr')||'');
Â  Â  Â  const ad = decodeURIComponent(btn.getAttribute('data-ad')||'');
Â  Â  Â  if (btn.textContent.includes('Ãudio')) {
Â  Â  Â  Â  speakText(data[eventoSelect.value].narrativas[narr] || '', "pt-BR", narr); 
Â  Â  Â  } else {
Â  Â  Â  Â  speakText(ad || '', "pt-BR", 'Narrador'); 
Â  Â  Â  }
Â  Â  });
Â  });
});

/ ===================== TTS: vozes diferentes por narrador ===================== /
let voices = [];
function loadVoices(){ 
Â  voices = speechSynthesis.getVoices() || []; 
Â  console.debug('Voices:', voices.map(v=>v.name + ' ' + v.lang)); 
Â  populateVoiceSelect(); 
Â  // Adiciona um pequeno delay para garantir que as vozes sejam carregadas (correÃ§Ã£o para alguns navegadores)
Â  if(voices.length === 0) {
Â  Â  setTimeout(populateVoiceSelect, 500);
Â  }
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

// FunÃ§Ã£o para popular o seletor de voz
function populateVoiceSelect() {
Â  if (voices.length === 0) {
Â  Â  voiceSelect.innerHTML = '<option value="">&nbsp;(Carregando vozes...)</option>';
Â  Â  return;
Â  }
Â  
Â  voiceSelect.innerHTML = '<option value="">&nbsp;(AutomÃ¡tico)</option>'; // &nbsp; para garantir que o dropdown nÃ£o suma
Â  const voicesByLang = voices.reduce((acc, voice) => {
Â  Â  const lang = voice.lang || 'Desconhecido';
Â  Â  if (!acc[lang]) acc[lang] = [];
Â  Â  acc[lang].push(voice);
Â  Â  return acc;
Â  }, {});

Â  Object.keys(voicesByLang).sort().forEach(lang => {
Â  Â  const optgroup = document.createElement('optgroup');
Â  Â  optgroup.label = lang;
Â  Â  voicesByLang[lang].forEach(voice => {
Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  option.value = voice.name;
Â  Â  Â  option.textContent = voice.name;
Â  Â  Â  optgroup.appendChild(option);
Â  Â  });
Â  Â  voiceSelect.appendChild(optgroup);
Â  });
Â  updateVoiceSelection(); 
}

function updateVoiceSelection() {
Â  const nar = narradorSelect.value;
Â  const preferredVoiceName = voiceMapping[nar] || '';
Â  let foundVoice = false;

Â  for (let i = 0; i < voiceSelect.options.length; i++) {
Â  Â  if (voiceSelect.options[i].value === preferredVoiceName) {
Â  Â  Â  voiceSelect.selectedIndex = i;
Â  Â  Â  foundVoice = true;
Â  Â  Â  break;
Â  Â  }
Â  }
Â  
Â  if (!foundVoice && voiceSelect.options[0] && voiceSelect.options[0].value === "") {
Â  Â  voiceSelect.selectedIndex = 0; 
Â  }
}


// configuraÃ§Ãµes por narrador (pitch/rate preferidos) - Mantido
const voiceSettings = {
Â  "Cronista portuguÃªs": { langPref: 'pt-PT', rate: 0.9, pitch: 1.0 },
Â  "IndÃ­gena": { langPref: 'pt-BR', rate: 1.0, pitch: 1.15 },
Â  "Africano escravizado": { langPref: 'pt-BR', rate: 1.05, pitch: 0.95 },
Â  "Estudante": { langPref: 'pt-BR', rate: 1.0, pitch: 1.0 }
};

function normalize(s){ return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,''); }
function hashString(str){ let h=0; for(let i=0;i<str.length;i++){ h = ((h<<5)-h) + str.charCodeAt(i); h |= 0; } return h; }

function pickVoiceForNarrator(narrator){
Â  const selectedVoiceName = voiceSelect.value;
Â  if (selectedVoiceName) {
Â  Â  const selectedVoice = voices.find(v => v.name === selectedVoiceName);
Â  Â  if (selectedVoice) return selectedVoice;
Â  }

Â  const vs = voiceSettings[narrator] || {langPref:'pt-BR', rate:1, pitch:1};
Â  if (!voices || voices.length===0) return null;
Â  const pref = (vs.langPref || '').toLowerCase();
Â  let voice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith(pref));
Â  if (!voice) {
Â  Â  voice = voices.find(v => v.lang && v.lang.toLowerCase().includes(pref.split('-')[0]));
Â  }
Â  if (!voice) {
Â  Â  const ptVoices = voices.filter(v => v.lang && v.lang.toLowerCase().includes('pt'));
Â  Â  if (ptVoices.length>0) {
Â  Â  Â  const idx = Math.abs(hashString(narrator)) % ptVoices.length;
Â  Â  Â  voice = ptVoices[idx];
Â  Â  }
Â  }
Â  if (!voice) voice = voices[0];
Â  return voice;
}

function speakText(text, lang='pt-BR', narrator='Estudante', opts = {}){
Â  stopAllAudio();
Â  speechSynthesis.cancel();
Â  if (!text || !text.trim()) return;
Â  
Â  const settings = voiceSettings[narrator] || {langPref:'pt-BR', rate:1, pitch:1};
Â  const chosen = pickVoiceForNarrator(narrator) || null; 
Â  
Â  const u = new SpeechSynthesisUtterance(text);
Â  u.lang = lang || 'pt-BR';
Â  if (chosen) u.voice = chosen;
Â  u.rate = opts.rate !== undefined ? opts.rate : settings.rate;
Â  u.pitch = opts.pitch !== undefined ? opts.pitch : settings.pitch;
Â  u.volume = opts.volume !== undefined ? opts.volume : 1.0;
Â  u.onstart = ()=> console.debug('TTS start', narrator, chosen ? chosen.name : 'no-voice');
Â  u.onend = ()=> console.debug('TTS end', narrator);
Â  u.onerror = (e)=> console.error('TTS error', e);
Â  speechSynthesis.speak(u);
}

/ ===================== Reproduzir Ã¡udio real (se existir) com fallback = TTS ===================== /
let currentAudio = null;
function stopAllAudio(){
Â  try { speechSynthesis.cancel(); } catch(e){}
Â  if (currentAudio) { try { currentAudio.pause(); currentAudio.currentTime = 0; } catch(e){} currentAudio = null; }
}

function getAudioPathFor(ev, nar) {
Â  const obj = audioMapping[ev] || {};
Â  if (obj[nar]) return obj[nar];
Â  const normNar = normalize(nar);
Â  for (const k of Object.keys(obj)) {
Â  Â  if (normalize(k) === normNar) return obj[k];
Â  }
Â  for (const k of Object.keys(obj)) {
Â  Â  if (normalize(k).includes(normNar.split(' ')[0]) || normNar.includes(normalize(k).split(' ')[0])) return obj[k];
Â  }
Â  return null;
}

playAudioBtn.addEventListener('click', ()=>{
Â  const ev = eventoSelect.value; const nar = narradorSelect.value;
Â  if (!ev || !nar) { updateRecordingStatus('âŒ Selecione evento e narrador antes de reproduzir'); return; }
Â  stopAllAudio();

Â  if (nar === "Estudante" && hasRecordingForCurrentEvent()) {
Â  Â  const url = getRecordingForCurrentEvent();
Â  Â  currentAudio = new Audio(url);
Â  Â  currentAudio.play().catch(e=>{
Â  Â  Â  console.error('Erro reproduÃ§Ã£o local:', e);
Â  Â  Â  speakText(data[ev].narrativas[nar]||'', 'pt-BR', nar);
Â  Â  });
Â  Â  return;
Â  }

Â  const audioPath = getAudioPathFor(ev, nar);
Â  if (audioPath) {
Â  Â  currentAudio = new Audio(audioPath);
Â  Â  currentAudio.play().catch(err=>{
Â  Â  Â  console.warn('Erro ao reproduzir arquivo (fallback TTS):', err);
Â  Â  Â  currentAudio = null;
Â  Â  Â  speakText(data[ev].narrativas[nar]||'', 'pt-BR', nar); 
Â  Â  });
Â  } else {
Â  Â  speakText(data[ev].narrativas[nar]||'', 'pt-BR', nar);
Â  }
});
stopAudioBtn.addEventListener('click', ()=> {
Â  stopAllAudio();
});

/ ===================== Recording (mantido) ===================== /
let mediaRecorder = null; let audioChunks = []; let audioStream = null;
function updateRecordingStatus(message,type=''){ recordingStatus.textContent = message; recordingStatus.className = 'recording-status'; if (type) recordingStatus.classList.add(type); }
function hasRecordingForCurrentEvent() { const ev = eventoSelect.value || ''; const eventKey = `recording_${ev.replace(/\s+/g,'_')}`; return localStorage.getItem(eventKey) !== null; }
function getRecordingForCurrentEvent() { const ev = eventoSelect.value || ''; const eventKey = `recording_${ev.replace(/\s+/g,'_')}`; const saved = localStorage.getItem(eventKey); if (saved) { const arr = new Uint8Array(JSON.parse(saved)); const blob = new Blob([arr], {type:'audio/webm'}); return URL.createObjectURL(blob); } return null; }
function saveRecording(blob) { const reader = new FileReader(); reader.onload = function(){ const arrayBuffer = this.result; const uint8 = new Uint8Array(arrayBuffer); const ev = eventoSelect.value || ''; const key = `recording_${ev.replace(/\s+/g,'_')}`; localStorage.setItem(key, JSON.stringify(Array.from(uint8))); updateRecordingStatus('âœ… GravaÃ§Ã£o salva com sucesso!','recording-saved'); recPlayBtn.disabled=false; recDeleteBtn.disabled=false; if (narradorSelect.value === "Estudante") narrativeText.textContent = "ğŸ¤ Narrativa em Ã¡udio disponÃ­vel - clique em 'Reproduzir GravaÃ§Ã£o' para ouvir."; }; reader.readAsArrayBuffer(blob); }
function deleteRecording() { const ev = eventoSelect.value || ''; const key = `recording_${ev.replace(/\s+/g,'_')}`; localStorage.removeItem(key); updateRecordingStatus('GravaÃ§Ã£o excluÃ­da'); recPlayBtn.disabled=true; recDeleteBtn.disabled=true; if (narradorSelect.value === "Estudante") narrativeText.textContent = data[ev].narrativas["Estudante"] || ""; }
async function initializeRecording(){ try{ if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) throw new Error('Sem suporte'); checkSavedRecording(); } catch(e){ console.error(e); recStartBtn.disabled=true; updateRecordingStatus('âŒ GravaÃ§Ã£o nÃ£o suportada neste navegador'); } }
function checkSavedRecording(){ if (hasRecordingForCurrentEvent()) { recPlayBtn.disabled=false; recDeleteBtn.disabled=false; updateRecordingStatus('GravaÃ§Ã£o disponÃ­vel para este evento'); } else { recPlayBtn.disabled=true; recDeleteBtn.disabled=true; updateRecordingStatus('Nenhuma gravaÃ§Ã£o salva para este evento'); } }

recStartBtn.addEventListener('click', async ()=> {
Â  if (!eventoSelect.value) { updateRecordingStatus('âŒ Selecione um evento primeiro'); return; }
Â  try {
Â  Â  audioStream = await navigator.mediaDevices.getUserMedia({ audio:{ echoCancellation:true, noiseSuppression:true, sampleRate:44100 }});
Â  Â  mediaRecorder = new MediaRecorder(audioStream, { mimeType:'audio/webm;codecs=opus' });
Â  Â  audioChunks = [];
Â  Â  mediaRecorder.ondataavailable = e => { if (e.data && e.data.size>0) audioChunks.push(e.data); };
Â  Â  mediaRecorder.onstop = () => { const blob = new Blob(audioChunks, { type:'audio/webm' }); saveRecording(blob); if (audioStream){ audioStream.getTracks().forEach(t=>t.stop()); audioStream=null; } };
Â  Â  mediaRecorder.onerror = ev => { console.error('Erro gravaÃ§Ã£o', ev); updateRecordingStatus('âŒ Erro na gravaÃ§Ã£o'); };
Â  Â  mediaRecorder.start();
Â  Â  recStartBtn.disabled=true; recStopBtn.disabled=false; recPlayBtn.disabled=true;
Â  Â  updateRecordingStatus('ğŸ”´ Gravando...', 'recording-active');
Â  } catch(e) {
Â  Â  console.error('Erro acesso microfone', e);
Â  Â  updateRecordingStatus('âŒ NÃ£o foi possÃ­vel acessar o microfone');
Â  Â  recStartBtn.disabled=true;
Â  }
});
recStopBtn.addEventListener('click', ()=> { if (mediaRecorder && mediaRecorder.state === 'recording'){ mediaRecorder.stop(); recStartBtn.disabled=false; recStopBtn.disabled=true; } });
recPlayBtn.addEventListener('click', ()=> {
Â  const url = getRecordingForCurrentEvent(); if (url) { if (currentAudio) { try{currentAudio.pause(); currentAudio.currentTime=0;}catch(e){} } speechSynthesis.cancel(); currentAudio = new Audio(url); currentAudio.play().catch(e=>{ console.error('Erro reproduzir gravaÃ§Ã£o', e); updateRecordingStatus('âŒ Erro ao reproduzir gravaÃ§Ã£o'); }); }
});
recDeleteBtn.addEventListener('click', deleteRecording);
eventoSelect.addEventListener('change', ()=> { checkSavedRecording(); });
initializeRecording();
</script>
</body>
</html>

<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hist√≥ricas Decoloniais</title>

<!-- ‚úÖ VLibras - CSS -->
<link rel="stylesheet" href="https://vlibras.gov.br/app/public/css/vlibras.css" />

<style>
/* --- Estilos ajustados --- */
:root{ --base-font:100%; }
html { font-size: var(--base-font); }

.main-title {
  font-size: 2rem;
  font-weight: bold;
  color: #004080;
  text-align: center;
  margin-bottom: 1rem;
}

.subtitle {
  text-align: justify; /* ‚Üê justificado */
  font-size: 1.2rem;
  color: #4b2e2e;
  max-width: 800px;
  margin: 0 auto 1rem auto;
  line-height: 1.6;
  padding: 0 1rem;
}
:root { --bg:#fbf6f6; --card:#d8d0d0; --fg:#0b1220; --muted:#556; --accent:#a0522d; }
body{ font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 1rem; background: #dabbac; color: var(--fg); }
h1,h2{ text-align:center; }
.card{ background:var(--card); border-radius:12px; padding:1rem; margin:1rem auto; max-width:900px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }

.selection-grid { 
    display: grid;
    grid-template-columns: auto 1fr; 
    gap: 8px 15px; 
    align-items: center;
    margin-bottom: 1rem;
}
.selection-grid label {
    text-align: left; 
    font-weight: bold;
}
.selection-grid select {
    width: 100%; 
}

select,button{ padding:0.5rem; margin:0.25rem 0; border-radius:6px; border:1px solid #6e6b6b; font-size:1rem; }
button { background-color: #a0522d; color: #fff; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; }
button:hover { background-color: #8b4513; }
button:disabled{ background:#ccc; color:#666; cursor:not-allowed; }
img{ max-width:100%; border-radius:8px; margin:0.5rem 0; }
.audio-btn{ margin-right:0.5rem; }
.compare-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1rem; margin-top:1rem; }
.recording-status { margin: 10px 0; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; }
.recording-active { background-color: #ffebee; color: #c62828; border: 1px solid #c62828; }
.recording-saved { background-color: #e8f5e8; color: #2e7d32; border: 1px solid #2e7d32; }

.high-contrast { background:#000 !important; color:#fff !important; }
.high-contrast .card { background:#111 !important; color:#fff !important; border: 1px solid #fff; }
.high-contrast button { background:#fff !important; color:#000 !important; border:1px solid #000 !important; }

.controls-row { margin-top: 8px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content: space-between; }
.small-btn { padding:6px 10px; font-size:0.9rem; border-radius:6px; background:#fff; color:#333; border:1px solid #999; cursor:pointer; }
.small-btn:focus { outline:3px solid #ffd600; }
button:focus, select:focus { outline:3px solid #ffd600; outline-offset:2px; }

#narrativeText {
    text-align: justify;
    line-height: 1.6;
}

.footer {
    text-align: center;
    margin-top: 30px;
    padding: 10px 0;
    font-size: 0.9rem;
    color: #4b2e2e;
}
.high-contrast .footer {
    color: #aaa;
}

#pdfComparisonBtn {
    display: none;
    margin: 1rem auto;
    padding: 8px 16px;
    font-size: 0.95rem;
}
</style>
</head>
<body>
<h1 class="main-title">
  <span class="typing-text">Hist√≥rias em Vozes: Um Olhar Decolonial</span>
</h1>

<div style="text-align: center; margin: 1rem auto 1.5rem auto;">
  <button id="btnAudioDesc" class="small-btn" title="Ouvir audiodescri√ß√£o do texto">üîä Audiodescri√ß√£o</button>
</div>

<p class="subtitle">Agora vamos comparar as narrativas hist√≥ricas. Podemos dizer que a hist√≥ria dos livros sempre tem raz√£o em rela√ß√£o aos eventos hist√≥ricos?</p>
<p class="subtitle">Esta √© a pergunta central que nos guiar√° a partir de agora. Em vez de aceitar uma √∫nica vers√£o do passado, iniciaremos uma profunda <strong>compara√ß√£o de narrativas hist√≥ricas</strong>. Analisaremos a diferen√ßa entre a hist√≥ria <em>oficial</em> (como a do Cronista portugu√™s, geralmente presente nos registros tradicionais) e as <strong>perspectivas silenciadas</strong> (como as do Ind√≠gena e do Afrodescendente/ex-escravizado).</p>
<p class="subtitle">Nossa miss√£o √© questionar: <strong>quem narra e quem √© narrado?</strong></p>
<p class="subtitle">Para isso, adotaremos uma lente cr√≠tica, valorizando os princ√≠pios da <strong>Decolonialidade</strong> e da <strong>Hist√≥ria Vista Por Baixo</strong>. O passado n√£o √© um bloco monol√≠tico, mas um mosaico de experi√™ncias onde a voz dos subalternos (os povos origin√°rios, os negros, os pobres) √© fundamental para desafiar as vers√µes hegem√¥nicas.</p>
<p class="subtitle">Al√©m disso, como estamos imersos na era digital, <strong>deixe sua pr√≥pria perspectiva</strong> sobre o assunto. Tamb√©m vamos <strong>problematizar as imagens e representa√ß√µes geradas por Intelig√™ncia Artificial (IA)</strong>, questionando se elas reproduzem ou rompem com os estere√≥tipos hist√≥ricos e vis√µes euroc√™ntricas.</p>
<p class="subtitle"><strong>√â hora de desvendar os m√∫ltiplos significados de um evento hist√≥rico, assumindo que a verdade hist√≥rica √© sempre disputada e constru√≠da.</strong></p>

<div class="card" aria-label="Sele√ß√£o e narrativa">
  <fieldset>
    <legend>Selecione evento e narrador</legend>
    <div class="selection-grid">
      <label for="eventoSelect">Evento:</label>
      <select id="eventoSelect" aria-label="Selecionar evento"></select>
      <label for="narradorSelect">Narrador:</label>
      <select id="narradorSelect" aria-label="Selecionar narrador"></select>
      <label for="voiceSelect">Voz para a narrativa:</label>
      <select id="voiceSelect" aria-label="Selecionar voz para a narrativa"></select>
    </div>

    <div class="controls-row" role="toolbar" aria-label="Controles principais">
        <div style="display:flex; gap:8px;">
            <button id="showNarrative">Mostrar narrativa</button>
            <button id="resetView">Limpar</button>
            <button id="compareBtn">Comparar narrativas</button>
        </div>

      <div style="display:flex; gap:8px;">
          <button id="contrastToggle" class="small-btn" aria-pressed="false" title="Alternar alto contraste">Alto contraste</button>
          <button id="fontInc" class="small-btn" title="Aumentar fonte">A+</button>
          <button id="fontDec" class="small-btn" title="Diminuir fonte">A‚àí</button>
        </div>
    </div>
  </fieldset>

  <div id="narrativeArea">
    <h2>Narrativa - O grande evento</h2>
    <div id="narrativeText" tabindex="0">Selecione um evento, um narrador e uma voz, depois clique em "Mostrar narrativa".</div>
    <div id="eventImageContainer" aria-live="polite"></div>

    <div id="audioControls" class="controls-row" aria-label="Controles de √°udio">
      <button id="playAudio" class="audio-btn">‚ñ∂Ô∏è Reproduzir √Åudio</button>
      <button id="stopAudio" class="audio-btn">‚èπÔ∏è Parar √Åudio</button>
      <button id="playAD" class="audio-btn" disabled>üë®üèø‚Äçü¶Ø Audiodescri√ß√£o da imagem</button>
    </div>
    <div id="comparisonArea"></div>
      
</div>

<div class="card">
  <h2>Conte-nos seu ponto de vista da hist√≥ria</h2>
  <p>Chegou sua vez: Selecione um Evento. <strong>Ao parar a grava√ß√£o, o √°udio ser√° salvo automaticamente</strong> para o narrador <strong>"Estudante"</strong> no evento em quest√£o.</p>
  <div id="recordingStatus" class="recording-status"></div>
  <button id="recStart">üî¥ Iniciar Grava√ß√£o</button>
  <button id="recStop" disabled>‚èπÔ∏è Parar e Salvar</button>
  <button id="recPlay" disabled>‚èØÔ∏è Reproduzir Grava√ß√£o</button>
  <button id="recDelete" disabled>üóëÔ∏è Excluir Grava√ß√£o</button>
</div>

<footer class="footer">
  ¬© 2025 Aline Concei√ß√£o Brito ‚Äî Desenvolvido para fins pedag√≥gicos. Todos os direitos reservados.
</footer>

<!-- ‚úÖ VLibras - Script (deve ficar antes do </body>) -->
<script src="https://vlibras.gov.br/app/public/js/vlibras.js"></script>
<script>
  new window.VLibras.Widget('https://vlibras.gov.br/app');
</script>

<script>
// ===================== DADOS (MANTIDOS) ===================== /
// (Seu c√≥digo JavaScript permanece exatamente igual ao anterior ‚Äî n√£o foi alterado)

const audioMapping = {
  "Coloniza√ß√£o do Brasil (s√©culo XVI e XVII)": {
    "Cronista portugu√™s": "https://soundcloud.com/aline-brito-225256690/portugues-chegada-2/s-dCPg2UDkmtL?in=aline-brito-225256690/sets/escolar/s-LJ6nxpK4cQY&si=229f25582b844b16bf9280a544b66294&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing",
    "Ind√≠gena": "  https://github.com/allineBrito/faculdade/blob/main/audio/portugues1.mp3  ",
    "Africano escravizado": "audio/negros-chegada.wav",
  },
  "Per√≠odo das Revoltas Regenciais (1831 ‚Äì 1840)": {
    "Cronista portugu√™s": "https://github.com/allineBrito/estudos_projetos/blob/main/audio/portuges-chegada.mp3  ",
    "Ind√≠gena": "audio/revolta_indi.mp3",
    "Africano escravizado": "audio/revolta_afri.mp3",
  },
  "Guerra de Canudos (1893 ‚Äì 1897)": {
    "Cronista portugu√™s": "audio/revolta_port.mp3",
    "Ind√≠gena": "audio/revolta_indi.mp3",
    "Africano escravizado": "audio/revolta_afri.mp3",
  }
};

const imageMapping = {
  "Cronista portugu√™s": "https://exemplo.com/perfil_cronista.jpg  ",
  "Ind√≠gena": "https://exemplo.com/perfil_indigena.png  ",
  "Africano escravizado": "https://exemplo.com/perfil_africano.png  ",
  "Mulher negra": "https://exemplo.com/perfil_mulher_negra.jpg  ",
  "Estudante": "https://i.ibb.co/JWjH7SGV/Chat-GPT-Image-15-de-out-de-2025-17-33-45.png  "
};

const eventImageMapping = {
  "Coloniza√ß√£o do Brasil (s√©culo XVI e XVII)": {
    "Cronista portugu√™s": "https://i.postimg.cc/Px50VhZn/Chat-GPT-Image-15-de-out-de-2025-12-17-49.png  ",
    "Ind√≠gena": "https://i.postimg.cc/xCphW7yG/Chat-GPT-Image-15-de-out-de-2025-12-22-26.png  ",
    "Africano escravizado": "https://i.postimg.cc/V6Zp3TBj/Chat-GPT-Image-15-de-out-de-2025-12-25-26.png  ",
    "Estudante": "https://i.ibb.co/JWjH7SGV/Chat-GPT-Image-15-de-out-de-2025-17-33-45.png  "
  },
  
  "Per√≠odo das Revoltas Regenciais (1831 ‚Äì 1840)": {
    "Cronista portugu√™s": "https://i.postimg.cc/rwL41pXf/Chat-GPT-Image-15-de-out-de-2025-12-36-56.png  ",
    "Ind√≠gena": "https://i.postimg.cc/c12wJmFF/Chat-GPT-Image-15-de-out-de-2025-12-41-13.png  ",
    "Africano escravizado": "https://i.postimg.cc/YCwF6SK8/Chat-GPT-Image-15-de-out-de-2025-12-44-04.png  ",
    "Estudante": "https://i.ibb.co/JWjH7SGV/Chat-GPT-Image-15-de-out-de-2025-17-33-45.png  "
  },
  
  "Guerra de Canudos (1893 ‚Äì 1897)": {
    "Cronista portugu√™s": "https://i.ibb.co/FRLQpz4/Chat-GPT-Image-15-de-out-de-2025-17-21-19.png  ",
    "Ind√≠gena": "https://i.ibb.co/hRXmL51L/Chat-GPT-Image-15-de-out-de-2025-17-14-13.png  ",
    "Africano escravizado": "https://i.ibb.co/7ttpfGWm/Chat-GPT-Image-15-de-out-de-2025-17-11-37.png  ",
    "Estudante": "https://i.ibb.co/JWjH7SGV/Chat-GPT-Image-15-de-out-de-2025-17-33-45.png  "
  }
};

const data = {
  "Coloniza√ß√£o do Brasil (s√©culo XVI e XVII)": {
    narrativas: {
      "Cronista portugu√™s": "Escutem, fi√©is s√∫ditos do Reino de Portugal! O que vemos no Brasil n√£o √© s√≥ uma terra distante, mas um novo e grandioso pilar do nosso Imp√©rio. Desde a chegada de Cabral, cumprimos o dever de tomar posse e levar a luz da nossa civiliza√ß√£o a estas terras do Novo Mundo. Nosso objetivo √© claro: a riqueza. Fizemos do litoral nordestino o maior produtor de a√ß√∫car do mundo ‚Äî o nosso Ouro Branco ‚Äî que enriquece a Europa e fortalece os cofres da Coroa. O sistema colonial que criamos √© firme e organizado: a monocultura, o Pacto Colonial e a ordem que garante que toda a abund√¢ncia ‚Äî do a√ß√∫car, da madeira, dos animais e do tabaco ‚Äî beneficie Lisboa. Aqui nada se perde. Tudo serve para a gl√≥ria do Reino de Portugal.",
      "Ind√≠gena": "Quando o povo do mar chegou, nossa vida mudou para sempre. Eles vieram como invasores, n√£o como amigos. No come√ßo, sentimos curiosidade e trocamos pau-brasil por ferro. Mas logo entendemos a verdade: queriam nossas terras e nossos corpos. Para eles, a floresta era mercadoria. Para n√≥s, era m√£e, ca√ßa e mem√≥ria dos ancestrais. Tentaram nos escravizar em planta√ß√µes erguidas sobre nossas aldeias. Chamaram-nos de √≠ndios cativos e venderam-nos como animais. As doen√ßas que trouxeram ‚Äî como var√≠ola e sarampo ‚Äî mataram muitas aldeias, mais do que as armas. Ainda assim, resistimos. Lutamos por nossos chefes, por nosso povo e por nossa liberdade. Nossa cultura e nossa l√≠ngua continuam vivas. A hist√≥ria do Brasil √© tamb√©m a hist√≥ria da nossa resist√™ncia, que nunca acabou.",
      "Africano escravizado": "Nossa hist√≥ria n√£o come√ßou no Brasil, mas nas terras da √Åfrica. Fomos tirados de nossos reinos √† for√ßa. O que os portugueses chamam de com√©rcio, n√≥s chamamos de Grande Roubo. Fomos levados em navios apertados, onde a fome e as doen√ßas matavam muitos antes de chegar aqui. No Brasil, n√£o √©ramos vistos como pessoas, mas como pe√ßas. Nosso corpo pertencia ao senhor, e nosso tempo era marcado pelo sol e pelo chicote. Nas planta√ß√µes e engenhos, o trabalho era pesado e a viol√™ncia, constante. Nossa vida valia menos que o a√ß√∫car que produz√≠amos. Mas nunca aceitamos o cativeiro. Constru√≠mos quilombos, guardamos nossas culturas e nossa f√©. O Brasil colonial foi feito de dor e escravid√£o, mas tamb√©m de luta e coragem. Nossa resist√™ncia nunca foi vencida.",
      "Estudante": ""
    },
    ad: {
      "Cronista portugu√™s": "Em uma pintura de estilo antigo, um homem europeu de barba escura, vestido com roupas t√≠picas do s√©culo XVI, fala com express√£o solene diante de outros colonos. Atr√°s dele, um grande pergaminho exibe um texto em portugu√™s exaltando o Imp√©rio. Ao fundo, v√™-se uma paisagem tropical, com palmeiras, rio e um navio portugu√™s ancorado. A cena transmite poder e dom√≠nio colonial",
      "Ind√≠gena": "Em uma pintura de tons quentes, um homem ind√≠gena aparece em primeiro plano, com express√£o de indigna√ß√£o e resist√™ncia. Ele est√° de p√©, com o corpo pintado e adornado por colar e pena na cabe√ßa. Ao fundo, h√° uma aldeia, floresta densa e um navio europeu no rio. Pr√≥ximo dele, um colonizador observa com semblante s√©rio. A imagem expressa o choque e o conflito entre os povos origin√°rios e os colonizadores",
      "Africano escravizado": "Em uma pintura de tom s√©pia e realista, um homem negro aparece em primeiro plano, com express√£o firme e olhar voltado para frente. Ele est√° sem camisa, usa uma cal√ßa simples e carrega pesadas correntes de ferro presas ao pesco√ßo e aos pulsos. Ao lado, um homem branco com chap√©u e barba observa em sil√™ncio. Ao fundo, trabalhadores aparecem cortando cana em uma planta√ß√£o e, mais distante, um navio est√° ancorado junto √† costa. A cena transmite sofrimento, resist√™ncia e dignidade diante da opress√£o",
      "Estudante": "Audiodescri√ß√£o aluno."
    }
  },

  "Per√≠odo das Revoltas Regenciais (1831 ‚Äì 1840)": {
    narrativas: {
      "Cronista portugu√™s": "A ordem do Imp√©rio est√° amea√ßada e a unidade do pa√≠s corre perigo. A falta de um imperador adulto abriu espa√ßo para fac√ß√µes rebeldes e para a pior parte da sociedade. Somos os guardi√µes da civiliza√ß√£o que Portugal trouxe a estas terras. Nosso dever √© manter o Brasil unido, pr√≥spero e hier√°rquico. As revoltas no Par√°, na Bahia e no Maranh√£o n√£o s√£o por justi√ßa, mas por desordem. S√£o grupos de desocupados, √≠ndios, caboclos e africanos que, em sua ignor√¢ncia, atacam a base da nossa economia. Nossas tropas agir√£o com for√ßa para esmagar essas sedi√ß√µes, restaurar a paz e mostrar ao mundo que o Brasil sabe se governar. Quem amea√ßar a ordem ser√° tratado como traidor da p√°tria.",
      "Ind√≠gena": "Nos chamam de cabanos, selvagens e desordeiros, mas somos os verdadeiros donos da floresta e das √°guas. Nossos antepassados cuidaram desta terra. Vimos os bar√µes do a√ß√∫car e do gado roubarem nossa terra enquanto vivem nas cidades. Quando D. Pedro I partiu, achamos que ser√≠amos ouvidos ‚Äî nada mudou para quem vive na pobreza √† beira do rio. A escravid√£o, a humilha√ß√£o e o roubo do nosso sustento continuam. Pegamos em armas por fome e por justi√ßa. Queremos governar o Par√°, que a terra perten√ßa a quem a trabalha, e que os tiranos que exploram nosso suor sejam expulsos. Lutamos para sobreviver; a for√ßa da floresta est√° conosco e nosso pedido por um governo justo √© mais forte que as balas do Imp√©rio.",
      "Africano escravizado": "Nos trouxeram em escravid√£o, mas n√£o conseguiram tomar nossa f√© nem nosso saber. Vimos a fraqueza do governo e soubemos que era hora de agir. Na Bahia, nos engenhos e nas ruas de Salvador, n√≥s, os Mal√™s, est√°vamos prontos. Conhec√≠amos disciplina e a Lei de Al√°. Quer√≠amos libertar nossos irm√£os, acabar com os senhores que nos oprimiam e criar um lugar de justi√ßa guiado por nossa cren√ßa. Lut√°vamos pela liberdade do corpo e da alma. Fomos tra√≠dos e a repress√£o foi terr√≠vel: nos prenderam, chicotearam e executaram. Mesmo assim, provamos que o escravo sabe resistir. Mostramos que podemos nos organizar e gerar esperan√ßa para quem sonha quebrar as correntes.",
      "Estudante": ""
    },
    ad: {
      "Cronista portugu√™s": "A ilustra√ß√£o, em tons s√©pia, retrata um homem de express√£o s√©ria e postura firme, vestido com uniforme militar do s√©culo XIX. Ele usa um chap√©u de cartola alto, tem bigode espesso e segura o punho de uma espada. Ao fundo, h√° uma paisagem com constru√ß√µes coloniais, uma igreja com torre e um pequeno barco navegando em um rio. √Ä direita da imagem, em um pergaminho desenrolado, est√° escrito em letras grandes: PER√çODO DAS REVOLTAS REGENCIAIS (1831‚Äì1840).",
      "Ind√≠gena": "A imagem mostra um homem ind√≠gena de apar√™ncia s√©ria e olhar firme, retratado do tronco para cima. Sua pele √© de tom cobre, e seus tra√ßos s√£o fortes ‚Äî rosto largo, express√£o determinada e olhos voltados para frente. Ele tem cabelos longos e lisos, que caem at√© os ombros. Na cabe√ßa, usa um cocar simples, feito com penas marrons presas por uma faixa tran√ßada. O homem est√° sem camisa, usando apenas um colar de corda fina e uma saia curta de tecido simples. Na m√£o direita, segura uma lan√ßa de madeira. Ao fundo, a paisagem √© suave e em tons esverdeados, mostrando a floresta borrada, sugerindo a imensid√£o da natureza. A imagem tem tons terrosos e claros, como se fosse uma pintura feita em papel envelhecido, transmitindo uma sensa√ß√£o de ancestralidade, resist√™ncia e liga√ß√£o com a terra.",
      "Africano escravizado": "A imagem mostra um homem negro de express√£o firme e olhar determinado, retratado do tronco para cima. Ele tem a pele escura, o rosto alongado e o olhar voltado ligeiramente para o lado, com semblante de coragem e resist√™ncia. Usa uma t√∫nica simples, de tecido claro e leve, presa na cintura por uma faixa amarrada. Na cabe√ßa, h√° um pano branco enrolado como um turbante, e ele segura um bast√£o de madeira com a m√£o direita. O fundo √© composto por tons terrosos e suaves, lembrando um campo aberto ou uma paisagem rural com √°rvores difusas ao longe. A ilustra√ß√£o √© feita em estilo s√©pia, com apar√™ncia de desenho a l√°pis sobre papel envelhecido, transmitindo uma atmosfera hist√≥rica e emocional. A imagem evoca a for√ßa, a dignidade e o esp√≠rito de luta de um africano escravizado que resiste √† opress√£o.",
      "Estudante": "Audiodescri√ß√£o aluno."
    }
  },

  "Guerra de Canudos (1893 ‚Äì 1897)": {
    narrativas: {
      "Cronista portugu√™s": "O movimento de Canudos foi visto por n√≥s como uma grande amea√ßa √† Rep√∫blica. Liderados por um homem que consider√°vamos fan√°tico, as tropas do ex√©rcito agiram para acabar com esse foco de desordem e impedir que ele atrapalhasse o progresso do pa√≠s. N√£o pod√≠amos permitir que tal foco de rebeldia e supersti√ß√£o prosperasse no Sert√£o. O dever do Ex√©rcito era restaurar a ordem e impor a lei da Rep√∫blica. Acredit√°vamos que a civiliza√ß√£o e a modernidade s√≥ seriam estabelecidas depois que a barb√°rie de Canudos fosse completamente extinta.",
      "Ind√≠gena": "N√≥s, os antigos donos desta terra, j√° sofremos demais nas m√£os dos homens de fora. A seca nos castiga, mas a gan√¢ncia dos coron√©is √© pior. Em Canudos, Ant√¥nio Conselheiro n√£o falava apenas de Deus, ele falava de justi√ßa e de um lugar onde n√£o ser√≠amos mais obrigados a beijar a m√£o de quem nos explora. A Rep√∫blica que chegou n√£o mudou nada para o sertanejo pobre, pelo contr√°rio: ela trouxe a exig√™ncia de impostos e a obriga√ß√£o de servir aos poderosos. O ataque a Canudos n√£o foi contra a 'desordem', foi para sufocar a √∫nica chance de vivermos livres e com dignidade em nosso pr√≥prio ch√£o, longe da humilha√ß√£o e da fome imposta por aqueles que s√≥ pensam em acumular terras.",
      "Africano escravizado": "Cinco anos depois da liberdade, para muitos de n√≥s, a escravid√£o s√≥ mudou de nome. A terra prometida n√£o chegou, e a mis√©ria nos empurra para os mesmos latif√∫ndios. Canudos foi um farol no sert√£o. O Conselheiro falava de um reino de Deus na Terra, onde os √∫ltimos seriam os primeiros, e isso ecoava a esperan√ßa que nunca morre no peito de quem carrega a mem√≥ria do cativeiro. L√°, √©ramos todos iguais na f√© e na luta, sem a marca da cor ou da senzala. A matan√ßa do Ex√©rcito n√£o foi um 'progresso', foi a repeti√ß√£o da viol√™ncia que sempre tentou calar nossa voz. Eles destru√≠ram o arraial, mas a cren√ßa na terra sem males, na resist√™ncia contra o opressor, √© uma semente que o fogo e a bala jamais poder√£o apagar. Canudos √© o nosso quilombo do sert√£o.",
      "Estudante": ""
    },
    ad: {
      "Cronista portugu√™s": "A cena mostra um grupo de soldados em meio a uma nuvem de poeira amarelada, avan√ßando em posi√ß√£o de ataque. Todos vestem uniformes em tom bege claro e chap√©us do tipo ‚Äúsafari‚Äù, caracter√≠sticos do final do s√©culo XIX. Carregam fuzis com baionetas presas na ponta e parecem se mover rapidamente, com express√µes de tens√£o e foco. O ambiente √© √°rido, e o fundo √© tomado por uma n√©voa de poeira que quase oculta os soldados mais distantes.",
      "Ind√≠gena": "No centro da imagem, um homem ind√≠gena, de pele morena e cabelos longos, ergue uma lan√ßa com o bra√ßo direito, pronto para atacar. Ele est√° descal√ßo e veste apenas um tecido simples na cintura. √Ä frente dele, um soldado branco, de uniforme claro e capacete, segura um fuzil com baioneta apontada em sua dire√ß√£o. Atr√°s do soldado, outros militares avan√ßam na mesma dire√ß√£o, empunhando armas semelhantes. A cena √© envolta em poeira, com tons amarelados que refor√ßam o clima √°rido e tenso do combate.",
      "Africano escravizado": "A imagem retrata o confronto direto entre soldados e homens negros. √Ä esquerda, tr√™s combatentes de pele escura e torsos nus seguram lan√ßas e avan√ßam, com express√µes firmes e corpo inclinado para frente. √Ä direita, um grupo de soldados uniformizados, com capacetes e fuzis com baionetas, prepara-se para o ataque. O solo levanta poeira, criando uma atmosfera densa e confusa, com tons terrosos predominando. O contraste entre os combatentes desarmados e os soldados uniformizados destaca a desigualdade das for√ßas em batalha.",
      "Estudante": "Audiodescri√ß√£o aluno."
    }
  }
};

const voiceMapping = {
  "Cronista portugu√™s": "Google portugu√™s do Brasil",
  "Ind√≠gena": "Microsoft Maria - Portuguese (Brazil)",
  "Africano escravizado": "Microsoft Daniel - Portuguese (Brazil)"
};

// ===================== elementos DOM ===================== /
const eventoSelect=document.getElementById('eventoSelect');
const narradorSelect=document.getElementById('narradorSelect');
const voiceSelect=document.getElementById('voiceSelect'); 
const narrativeText=document.getElementById('narrativeText');
const eventImageContainer=document.getElementById('eventImageContainer');
const playAudioBtn=document.getElementById('playAudio');
const stopAudioBtn=document.getElementById('stopAudio');
const playADBtn=document.getElementById('playAD');
const compareBtn=document.getElementById('compareBtn');
const comparisonArea=document.getElementById('comparisonArea');
const resetViewBtn=document.getElementById('resetView');

const contrastToggle = document.getElementById('contrastToggle');
const fontInc = document.getElementById('fontInc');
const fontDec = document.getElementById('fontDec');

const recStartBtn = document.getElementById('recStart');
const recStopBtn = document.getElementById('recStop');
const recPlayBtn = document.getElementById('recPlay');
const recDeleteBtn = document.getElementById('recDelete');
const recordingStatus = document.getElementById('recordingStatus');

// Bot√£o de audiodescri√ß√£o ‚Äî agora l√™ todo o texto introdut√≥rio
document.getElementById("btnAudioDesc").addEventListener("click", () => {
  const mainTitle = document.querySelector(".main-title .typing-text")?.textContent || "";
  const subtitles = Array.from(document.querySelectorAll(".subtitle"))
    .map(p => p.textContent)
    .join(" ");
  const fullIntroText = [mainTitle, subtitles].filter(Boolean).join(". ");
  if (!fullIntroText.trim()) {
    console.warn("Nenhum texto introdut√≥rio encontrado para ler.");
    return;
  }
  const utterance = new SpeechSynthesisUtterance(fullIntroText);
  utterance.lang = "pt-BR";
  utterance.rate = 1;
  speechSynthesis.speak(utterance);
});

function createPDFButton() {
  const btn = document.createElement('button');
  btn.id = 'pdfComparisonBtn';
  btn.className = 'small-btn';
  btn.textContent = 'üñ®Ô∏è Imprimir PDF dos comparativos';
  btn.title = 'Imprimir compara√ß√£o em PDF';
  btn.style.display = 'block';
  btn.addEventListener('click', () => {
    const content = document.getElementById("comparisonArea").innerHTML;
    const printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write('<html><head><title>Compara√ß√£o de Narrativas</title>');
    printWindow.document.write('<style>body{font-family:Arial,sans-serif;padding:20px;}</style></head><body>');
    printWindow.document.write(content);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
  });
  return btn;
}

// ===================== preencher selects ===================== /
Object.keys(data).forEach(ev=>{
  let opt=document.createElement('option'); opt.value=ev; opt.textContent=ev;
  eventoSelect.appendChild(opt);
});
function populateNarrators(){
  narradorSelect.innerHTML='';
  if(eventoSelect.value && data[eventoSelect.value]){
    Object.keys(data[eventoSelect.value].narrativas).forEach(n=>{
      let o=document.createElement('option'); o.value=n; o.textContent=n;
      narradorSelect.appendChild(o);
    });
    updateVoiceSelection(); 
  }
}
eventoSelect.addEventListener('change', populateNarrators);
narradorSelect.addEventListener('change', updateVoiceSelection); 
populateNarrators();

// ===================== CONTRASTE e FONTE ===================== /
contrastToggle.addEventListener('click', ()=> {
  const pressed = contrastToggle.getAttribute('aria-pressed') === 'true';
  contrastToggle.setAttribute('aria-pressed', String(!pressed));
  document.body.classList.toggle('high-contrast');
  contrastToggle.focus();
});
let baseFont = 100;
fontInc.addEventListener('click', ()=> { baseFont = Math.min(160, baseFont + 10); document.documentElement.style.setProperty('--base-font', baseFont + '%'); fontInc.focus(); });
fontDec.addEventListener('click', ()=> { baseFont = Math.max(70, baseFont - 10); document.documentElement.style.setProperty('--base-font', baseFont + '%'); fontDec.focus(); });

// ===================== Mostrar narrativa ===================== /
resetViewBtn.addEventListener('click', ()=>{
  eventoSelect.selectedIndex=0; narradorSelect.innerHTML=''; narrativeText.textContent='Selecione um evento e um narrador, depois clique em "Mostrar narrativa".';
  eventImageContainer.innerHTML=''; playADBtn.disabled=true; comparisonArea.innerHTML=''; updateRecordingStatus('');
  populateNarrators(); 
});
document.getElementById('showNarrative').addEventListener('click', ()=>{
  const ev=eventoSelect.value, nar=narradorSelect.value;
  if(!ev || !nar) return;
  if (nar === "Estudante" && hasRecordingForCurrentEvent()) {
    narrativeText.textContent = "üé§ Narrativa em √°udio dispon√≠vel - clique em 'Reproduzir Grava√ß√£o' para ouvir.";
  } else {
    narrativeText.textContent = data[ev].narrativas[nar] || '';
  }
  const eventImgSrc = eventImageMapping[ev] ? eventImageMapping[ev][nar] : '';
  let imageToShow = eventImgSrc || imageMapping[nar] || '';
  let altText = imageToShow ? `Imagem do evento ${ev} na perspectiva de ${nar}` : '';
  eventImageContainer.innerHTML = imageToShow ? `<img src="${imageToShow}" alt="${altText}">` : '';
  playADBtn.disabled = !data[ev].ad[nar];
  playADBtn.onclick = ()=> speakText(data[ev].ad[nar] || '', "pt-BR", nar);
});

// ===================== comparar ===================== /
compareBtn.addEventListener('click', ()=>{
  const ev=eventoSelect.value; if(!ev) return;
  const narrativas=data[ev].narrativas; const ads=data[ev].ad;
  comparisonArea.innerHTML = "";
  const oldPDFBtn = document.getElementById('pdfComparisonBtn');
  if (oldPDFBtn) oldPDFBtn.remove();
  const pdfBtn = createPDFButton();
  comparisonArea.parentNode.insertBefore(pdfBtn, comparisonArea);
  const container=document.createElement('div'); container.className="compare-grid";
  Object.keys(narrativas).forEach(n=>{
    const div=document.createElement('div'); div.className='card';
    const compareImgSrc = eventImageMapping[ev] && eventImageMapping[ev][n] ? eventImageMapping[ev][n] : imageMapping[n];
    const altText = `Imagem do evento ${ev} na perspectiva de ${n}`;
    let textoNarrativa = narrativas[n] || '';
    if (n === "Estudante" && hasRecordingForCurrentEvent()) textoNarrativa = "üé§ Narrativa em √°udio (grava√ß√£o do estudante)";
    div.innerHTML = `
      <h3>${n}</h3>
      <p style="text-align: justify; line-height: 1.6;">${textoNarrativa}</p>
      ${compareImgSrc ? `<img src="${compareImgSrc}" alt="${altText}">` : ''}
      <div style="margin-top:8px;">
        <button class="small-btn" data-narr="${encodeURIComponent(n)}">‚ñ∂Ô∏è √Åudio</button>
        <button class="small-btn" data-ad="${encodeURIComponent(ads[n]||'')}">‚ôø Audiodescri√ß√£o da </button>
      </div>
    `;
    container.appendChild(div);
  });
  comparisonArea.appendChild(container);
  comparisonArea.querySelectorAll('button.small-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const narr = decodeURIComponent(btn.getAttribute('data-narr')||'');
      const ad = decodeURIComponent(btn.getAttribute('data-ad')||'');
      if (btn.textContent.includes('√Åudio')) {
        speakText(data[eventoSelect.value].narrativas[narr] || '', "pt-BR", narr); 
      } else {
        speakText(ad || '', "pt-BR", 'Narrador'); 
      }
    });
  });
  pdfBtn.style.display = 'block';
});

// ===================== TTS ===================== /
let voices = [];
function loadVoices(){ 
  voices = speechSynthesis.getVoices() || []; 
  populateVoiceSelect(); 
  if(voices.length === 0) setTimeout(populateVoiceSelect, 500);
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function populateVoiceSelect() {
  if (voices.length === 0) {
    voiceSelect.innerHTML = '<option value="">&nbsp;(Carregando vozes...)</option>';
    return;
  }
  voiceSelect.innerHTML = '<option value="">&nbsp;(Autom√°tico)</option>';
  const voicesByLang = voices.reduce((acc, voice) => {
    const lang = voice.lang || 'Desconhecido';
    if (!acc[lang]) acc[lang] = [];
    acc[lang].push(voice);
    return acc;
  }, {});
  Object.keys(voicesByLang).sort().forEach(lang => {
    const optgroup = document.createElement('optgroup');
    optgroup.label = lang;
    voicesByLang[lang].forEach(voice => {
      const option = document.createElement('option');
      option.value = voice.name;
      option.textContent = voice.name;
      optgroup.appendChild(option);
    });
    voiceSelect.appendChild(optgroup);
  });
  updateVoiceSelection(); 
}

function updateVoiceSelection() {
  const nar = narradorSelect.value;
  const preferredVoiceName = voiceMapping[nar] || '';
  let foundVoice = false;
  for (let i = 0; i < voiceSelect.options.length; i++) {
    if (voiceSelect.options[i].value === preferredVoiceName) {
      voiceSelect.selectedIndex = i;
      foundVoice = true;
      break;
    }
  }
  if (!foundVoice && voiceSelect.options[0] && voiceSelect.options[0].value === "") {
    voiceSelect.selectedIndex = 0; 
  }
}

const voiceSettings = {
  "Cronista portugu√™s": { langPref: 'pt-PT', rate: 0.9, pitch: 1.0 },
  "Ind√≠gena": { langPref: 'pt-BR', rate: 1.0, pitch: 1.15 },
  "Africano escravizado": { langPref: 'pt-BR', rate: 1.05, pitch: 0.95 },
  "Estudante": { langPref: 'pt-BR', rate: 1.0, pitch: 1.0 }
};

function normalize(s){ return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,''); }
function hashString(str){ let h=0; for(let i=0;i<str.length;i++){ h = ((h<<5)-h) + str.charCodeAt(i); h |= 0; } return h; }

function pickVoiceForNarrator(narrator){
  const selectedVoiceName = voiceSelect.value;
  if (selectedVoiceName) {
    const selectedVoice = voices.find(v => v.name === selectedVoiceName);
    if (selectedVoice) return selectedVoice;
  }
  const vs = voiceSettings[narrator] || {langPref:'pt-BR', rate:1, pitch:1};
  if (!voices || voices.length===0) return null;
  const pref = (vs.langPref || '').toLowerCase();
  let voice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith(pref));
  if (!voice) voice = voices.find(v => v.lang && v.lang.toLowerCase().includes(pref.split('-')[0]));
  if (!voice) {
    const ptVoices = voices.filter(v => v.lang && v.lang.toLowerCase().includes('pt'));
    if (ptVoices.length>0) {
      const idx = Math.abs(hashString(narrator)) % ptVoices.length;
      voice = ptVoices[idx];
    }
  }
  if (!voice) voice = voices[0];
  return voice;
}

function speakText(text, lang='pt-BR', narrator='Estudante', opts = {}){
  speechSynthesis.cancel();
  if (!text || !text.trim()) return;
  const settings = voiceSettings[narrator] || {langPref:'pt-BR', rate:1, pitch:1};
  const chosen = pickVoiceForNarrator(narrator) || null; 
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang || 'pt-BR';
  if (chosen) u.voice = chosen;
  u.rate = opts.rate !== undefined ? opts.rate : settings.rate;
  u.pitch = opts.pitch !== undefined ? opts.pitch : settings.pitch;
  u.volume = opts.volume !== undefined ? opts.volume : 1.0;
  speechSynthesis.speak(u);
}

// ===================== Reproduzir √°udio ===================== /
let currentAudio = null;
function stopAllAudio(){
  try { speechSynthesis.cancel(); } catch(e){}
  if (currentAudio) { try { currentAudio.pause(); currentAudio.currentTime = 0; } catch(e){} currentAudio = null; }
}

function getAudioPathFor(ev, nar) {
  const obj = audioMapping[ev] || {};
  if (obj[nar]) return obj[nar];
  const normNar = normalize(nar);
  for (const k of Object.keys(obj)) {
    if (normalize(k) === normNar) return obj[k];
  }
  for (const k of Object.keys(obj)) {
    if (normalize(k).includes(normNar.split(' ')[0]) || normNar.includes(normalize(k).split(' ')[0])) return obj[k];
  }
  return null;
}

playAudioBtn.addEventListener('click', ()=>{
  const ev = eventoSelect.value; const nar = narradorSelect.value;
  if (!ev || !nar) { updateRecordingStatus('‚ùå Selecione evento e narrador antes de reproduzir'); return; }
  stopAllAudio();
  if (nar === "Estudante" && hasRecordingForCurrentEvent()) {
    const url = getRecordingForCurrentEvent();
    currentAudio = new Audio(url);
    currentAudio.play().catch(e=>{
      console.error('Erro reprodu√ß√£o local:', e);
      speakText(data[ev].narrativas[nar]||'', 'pt-BR', nar);
    });
    return;
  }
  const audioPath = getAudioPathFor(ev, nar);
  if (audioPath) {
    currentAudio = new Audio(audioPath);
    currentAudio.play().catch(err=>{
      console.warn('Erro ao reproduzir arquivo (fallback TTS):', err);
      currentAudio = null;
      speakText(data[ev].narrativas[nar]||'', 'pt-BR', nar); 
    });
  } else {
    speakText(data[ev].narrativas[nar]||'', 'pt-BR', nar);
  }
});
stopAudioBtn.addEventListener('click', ()=> {
  stopAllAudio();
});

// ===================== Recording ===================== /
let mediaRecorder = null; let audioChunks = []; let audioStream = null;
function updateRecordingStatus(message,type=''){ recordingStatus.textContent = message; recordingStatus.className = 'recording-status'; if (type) recordingStatus.classList.add(type); }
function hasRecordingForCurrentEvent() { const ev = eventoSelect.value || ''; const eventKey = `recording_${ev.replace(/\s+/g,'_')}`; return localStorage.getItem(eventKey) !== null; }
function getRecordingForCurrentEvent() { const ev = eventoSelect.value || ''; const eventKey = `recording_${ev.replace(/\s+/g,'_')}`; const saved = localStorage.getItem(eventKey); if (saved) { const arr = new Uint8Array(JSON.parse(saved)); const blob = new Blob([arr], {type:'audio/webm'}); return URL.createObjectURL(blob); } return null; }
function saveRecording(blob) { const reader = new FileReader(); reader.onload = function(){ const arrayBuffer = this.result; const uint8 = new Uint8Array(arrayBuffer); const ev = eventoSelect.value || ''; const key = `recording_${ev.replace(/\s+/g,'_')}`; localStorage.setItem(key, JSON.stringify(Array.from(uint8))); updateRecordingStatus('‚úÖ Grava√ß√£o salva com sucesso!','recording-saved'); recPlayBtn.disabled=false; recDeleteBtn.disabled=false; if (narradorSelect.value === "Estudante") narrativeText.textContent = "üé§ Narrativa em √°udio dispon√≠vel - clique em 'Reproduzir Grava√ß√£o' para ouvir."; }; reader.readAsArrayBuffer(blob); }
function deleteRecording() { const ev = eventoSelect.value || ''; const key = `recording_${ev.replace(/\s+/g,'_')}`; localStorage.removeItem(key); updateRecordingStatus('Grava√ß√£o exclu√≠da'); recPlayBtn.disabled=true; recDeleteBtn.disabled=true; if (narradorSelect.value === "Estudante") narrativeText.textContent = data[ev].narrativas["Estudante"] || ""; }
async function initializeRecording(){ try{ if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) throw new Error('Sem suporte'); checkSavedRecording(); } catch(e){ console.error(e); recStartBtn.disabled=true; updateRecordingStatus('‚ùå Grava√ß√£o n√£o suportada neste navegador'); } }
function checkSavedRecording(){ if (hasRecordingForCurrentEvent()) { recPlayBtn.disabled=false; recDeleteBtn.disabled=false; updateRecordingStatus('Grava√ß√£o dispon√≠vel para este evento'); } else { recPlayBtn.disabled=true; recDeleteBtn.disabled=true; updateRecordingStatus('Nenhuma grava√ß√£o salva para este evento'); } }

recStartBtn.addEventListener('click', async ()=> {
  if (!eventoSelect.value) { updateRecordingStatus('‚ùå Selecione um evento primeiro'); return; }
  try {
    audioStream = await navigator.mediaDevices.getUserMedia({ audio:{ echoCancellation:true, noiseSuppression:true, sampleRate:44100 }});
    mediaRecorder = new MediaRecorder(audioStream, { mimeType:'audio/webm;codecs=opus' });
    audioChunks = [];
    mediaRecorder.ondataavailable = e => { if (e.data && e.data.size>0) audioChunks.push(e.data); };
    mediaRecorder.onstop = () => { const blob = new Blob(audioChunks, { type:'audio/webm' }); saveRecording(blob); if (audioStream){ audioStream.getTracks().forEach(t=>t.stop()); audioStream=null; } };
    mediaRecorder.onerror = ev => { console.error('Erro grava√ß√£o', ev); updateRecordingStatus('‚ùå Erro na grava√ß√£o'); };
    mediaRecorder.start();
    recStartBtn.disabled=true; recStopBtn.disabled=false; recPlayBtn.disabled=true;
    updateRecordingStatus('üî¥ Gravando...', 'recording-active');
  } catch(e) {
    console.error('Erro acesso microfone', e);
    updateRecordingStatus('‚ùå N√£o foi poss√≠vel acessar o microfone');
    recStartBtn.disabled=true;
  }
});
recStopBtn.addEventListener('click', ()=> { if (mediaRecorder && mediaRecorder.state === 'recording'){ mediaRecorder.stop(); recStartBtn.disabled=false; recStopBtn.disabled=true; } });
recPlayBtn.addEventListener('click', ()=> {
  const url = getRecordingForCurrentEvent(); if (url) { if (currentAudio) { try{currentAudio.pause(); currentAudio.currentTime=0;}catch(e){} } speechSynthesis.cancel(); currentAudio = new Audio(url); currentAudio.play().catch(e=>{ console.error('Erro reproduzir grava√ß√£o', e); updateRecordingStatus('‚ùå Erro ao reproduzir grava√ß√£o'); }); }
});
recDeleteBtn.addEventListener('click', deleteRecording);
eventoSelect.addEventListener('change', ()=> { checkSavedRecording(); });
initializeRecording();
</script>
</body>
</html>
